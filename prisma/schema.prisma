datasource db {
  provider = "postgresql"
  url      = env("APP_DATABASE_URL")
}

generator client {
  provider        = "prisma-client-js"
}

model User {
  id  String @unique@default(uuid())
  data Json?
  given String        @default("")
  family String       @default("")
  connectUserID String @unique @default("")
  email         String @unique @default("")
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt @default(now())
}

model Event {
  id   String @id @default(uuid())
  type EventType
  userID  String?
  projectID String?
  createdAt           DateTime             @default(now())
}

enum EventType  {
  Registration 
  ProjectCreated 
  UpdateConnectID 
  Login
}

model Project {
  id   String @id @default(uuid())
  data Json? 
  @@index([data(ops: JsonbPathOps)], type: Gin, map: "project_json_data_idx")
}

model ManuscriptDoc {
  manuscript_model_id String               @id @default(uuid())
  user_model_id       String
  project_model_id    String
  doc                 Json
  version             Int                  @default(0)
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  snapshots           ManuscriptSnapshot[] @relation("ManuscriptSnapshotToManuscriptDoc")
  steps               Json[]               @default([])

  @@index(fields: [project_model_id], map: "project_model_id_idx_2")
}

model ManuscriptSnapshot {
  id        String        @id @default(uuid())
  name      String        @default("") @db.VarChar(500)
  snapshot  Json
  createdAt DateTime      @default(now())
  doc       ManuscriptDoc @relation("ManuscriptSnapshotToManuscriptDoc", fields: [doc_id], references: [manuscript_model_id], onDelete: Cascade)
  doc_id    String

  @@index(fields: [doc_id],map: "doc_id_idx_2")
}

model ManuscriptDocHistory {
  doc_id    String
  version   Int
  client_id String
  steps     Json[]

  @@id([doc_id, version])
}
